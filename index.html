<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rifqy-FI | Wealth OS</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* BASE STYLES */
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #0F1115;
            color: #ffffff;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        /* GLASSMORPHISM & BLUR */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .glass-nav {
            background: rgba(15, 17, 21, 0.85);
            backdrop-filter: blur(15px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* ATM CARD GRADIENT */
        .atm-card {
            background: linear-gradient(120deg, #1a237e 0%, #0d47a1 50%, #00bcd4 100%);
            box-shadow: 0 10px 30px -10px rgba(0, 188, 212, 0.5);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .atm-card::after {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 50%; height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.2), transparent);
            transform: skewX(-25deg);
            animation: shine 6s infinite;
        }

        @keyframes shine { 
            0% { left: -100%; } 
            20% { left: 200%; } 
            100% { left: 200%; } 
        }

        /* ANIMATIONS */
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; transform: translateY(20px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        
        .slide-up-modal { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; transform: translateY(100%); }
        @keyframes slideUp { to { transform: translateY(0); } }

        /* CUSTOM SCROLLBAR */
        .hide-scroll::-webkit-scrollbar { display: none; }
        
        /* UI TWEAKS */
        .rupiah-input:focus { box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); }
    </style>
</head>
<body class="antialiased pb-32">

    <div id="loader" class="fixed inset-0 z-[100] bg-[#0F1115] flex flex-col items-center justify-center gap-4 transition-opacity duration-500">
        <div class="relative w-16 h-16">
            <div class="absolute inset-0 rounded-full border-4 border-blue-500/20"></div>
            <div class="absolute inset-0 rounded-full border-4 border-t-blue-500 animate-spin"></div>
            <div class="absolute inset-4 rounded-full bg-blue-500/20 blur-md"></div>
        </div>
        <p class="text-xs font-semibold tracking-widest text-blue-500 animate-pulse">MEMUAT RIFQY-FI...</p>
    </div>

    <div id="loginScreen" class="fixed inset-0 z-50 flex flex-col items-center justify-center bg-[#0F1115] px-8 hidden">
        <div class="absolute top-[-10%] left-[-20%] w-[300px] h-[300px] bg-blue-600/20 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] right-[-20%] w-[300px] h-[300px] bg-purple-600/20 rounded-full blur-[100px]"></div>

        <div class="relative z-10 w-full max-w-sm text-center space-y-8">
            <div class="w-24 h-24 bg-gradient-to-br from-blue-600 to-cyan-500 rounded-3xl flex items-center justify-center mx-auto shadow-2xl shadow-blue-500/30 mb-4 rotate-3 hover:rotate-0 transition-transform duration-500">
                <i class="ph-fill ph-wallet text-5xl text-white"></i>
            </div>
            
            <div class="space-y-2">
                <h1 class="text-4xl font-extrabold tracking-tight text-white">Rifqy-FI</h1>
                <p class="text-slate-400 text-lg">Your Personal Wealth OS</p>
            </div>

            <button onclick="loginGoogle()" class="group relative w-full bg-white text-slate-900 h-14 rounded-2xl font-bold text-lg flex items-center justify-center gap-3 transition-all active:scale-95 hover:shadow-[0_0_30px_rgba(255,255,255,0.2)]">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-6 h-6">
                <span>Masuk dengan Google</span>
            </button>
            <p class="text-xs text-slate-600 mt-8">Secure Authentication by Google Firebase</p>
        </div>
    </div>

    <div id="app" class="hidden max-w-lg mx-auto relative z-10">
        
        <header class="flex justify-between items-center p-6 pt-8 fade-in" style="animation-delay: 0.1s;">
            <div class="flex items-center gap-3">
                <div class="relative group">
                    <img id="userImg" src="" class="w-11 h-11 rounded-full border-2 border-slate-700/50 object-cover">
                    <div class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-[#0F1115] rounded-full"></div>
                </div>
                <div class="flex flex-col">
                    <span id="greeting" class="text-[10px] font-bold text-blue-400 tracking-wider uppercase">SELAMAT DATANG</span>
                    <h2 id="userName" class="text-lg font-bold text-white leading-tight">Rifqy</h2>
                </div>
            </div>
            <button onclick="logout()" class="w-10 h-10 rounded-full glass-panel flex items-center justify-center text-slate-400 hover:text-red-400 hover:bg-red-500/10 transition-colors">
                <i class="ph-bold ph-sign-out text-xl"></i>
            </button>
        </header>

        <section class="px-6 fade-in" style="animation-delay: 0.2s;">
            <div class="atm-card rounded-[28px] p-7 text-white mb-6">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <p class="text-blue-100/80 text-xs font-medium tracking-wide mb-1">TOTAL ASSETS</p>
                        <div class="flex items-center gap-3">
                            <h1 id="mainBalance" class="text-3xl font-bold tracking-tight">Rp 0</h1>
                            <button onclick="toggleView()" class="opacity-70 hover:opacity-100 transition-opacity">
                                <i id="eyeIcon" class="ph-bold ph-eye text-xl"></i>
                            </button>
                        </div>
                    </div>
                    <i class="ph-fill ph-contactless-payment text-4xl opacity-50"></i>
                </div>

                <div class="mb-5">
                    <div class="flex justify-between text-[10px] text-blue-100/70 mb-1.5">
                        <span>Limit Bulanan</span>
                        <span id="healthText">Safe Zone</span>
                    </div>
                    <div class="w-full h-1.5 bg-black/20 rounded-full overflow-hidden">
                        <div id="healthBar" class="h-full bg-green-400 rounded-full w-0 transition-all duration-1000"></div>
                    </div>
                </div>

                <div class="flex gap-4">
                    <div class="flex-1 bg-black/20 rounded-xl p-3 backdrop-blur-sm">
                        <div class="flex items-center gap-2 mb-1">
                            <div class="w-1.5 h-1.5 rounded-full bg-green-400"></div>
                            <span class="text-[10px] text-blue-100/70">Pemasukan</span>
                        </div>
                        <p id="totalIn" class="font-semibold text-sm">+Rp 0</p>
                    </div>
                    <div class="flex-1 bg-black/20 rounded-xl p-3 backdrop-blur-sm">
                        <div class="flex items-center gap-2 mb-1">
                            <div class="w-1.5 h-1.5 rounded-full bg-red-400"></div>
                            <span class="text-[10px] text-blue-100/70">Pengeluaran</span>
                        </div>
                        <p id="totalOut" class="font-semibold text-sm">-Rp 0</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="px-6 grid grid-cols-4 gap-3 mb-8 fade-in" style="animation-delay: 0.3s;">
            <button onclick="quickAdd('Makan', 'out', 'ph-hamburger')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 rounded-2xl glass-panel flex items-center justify-center text-orange-400 text-2xl group-active:scale-95 transition-all bg-orange-500/5 hover:bg-orange-500/20">
                    <i class="ph-fill ph-hamburger"></i>
                </div>
                <span class="text-[10px] text-slate-400 font-medium">Makan</span>
            </button>
            <button onclick="quickAdd('Transport', 'out', 'ph-car')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 rounded-2xl glass-panel flex items-center justify-center text-blue-400 text-2xl group-active:scale-95 transition-all bg-blue-500/5 hover:bg-blue-500/20">
                    <i class="ph-fill ph-car"></i>
                </div>
                <span class="text-[10px] text-slate-400 font-medium">Jalan</span>
            </button>
            <button onclick="quickAdd('Belanja', 'out', 'ph-shopping-bag')" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 rounded-2xl glass-panel flex items-center justify-center text-purple-400 text-2xl group-active:scale-95 transition-all bg-purple-500/5 hover:bg-purple-500/20">
                    <i class="ph-fill ph-shopping-bag"></i>
                </div>
                <span class="text-[10px] text-slate-400 font-medium">Belanja</span>
            </button>
            <button onclick="openModal()" class="flex flex-col items-center gap-2 group">
                <div class="w-14 h-14 rounded-2xl glass-panel flex items-center justify-center text-green-400 text-2xl group-active:scale-95 transition-all bg-green-500/5 hover:bg-green-500/20">
                    <i class="ph-bold ph-dots-three"></i>
                </div>
                <span class="text-[10px] text-slate-400 font-medium">Manual</span>
            </button>
        </section>

        <section class="px-6 fade-in" style="animation-delay: 0.4s;">
            <div class="flex justify-between items-end mb-4">
                <h3 class="font-bold text-lg">Riwayat Transaksi</h3>
                <span class="text-xs text-slate-500">Tekan lama untuk hapus</span>
            </div>
            
            <div id="listTrx" class="space-y-3 pb-10 min-h-[200px]">
                </div>
        </section>
    </div>

    <nav id="bottomNav" class="fixed bottom-0 left-0 w-full glass-nav z-40 hidden pb-safe">
        <div class="flex justify-around items-center h-20 max-w-lg mx-auto relative">
            <button class="flex flex-col items-center text-blue-500 p-2">
                <i class="ph-fill ph-house text-2xl"></i>
            </button>
            
            <button onclick="openModal()" class="absolute -top-8 left-1/2 -translate-x-1/2 w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center text-white shadow-lg shadow-blue-500/40 hover:scale-105 active:scale-95 transition-all border-4 border-[#0F1115]">
                <i class="ph-bold ph-plus text-2xl"></i>
            </button>

            <button class="flex flex-col items-center text-slate-500 hover:text-slate-300 p-2 transition-colors">
                <i class="ph-bold ph-chart-pie-slice text-2xl"></i>
            </button>
        </div>
    </nav>

    <div id="modalTrx" class="fixed inset-0 z-[60] bg-black/80 backdrop-blur-sm hidden flex items-end sm:items-center justify-center p-4">
        <div id="modalContent" class="bg-[#1A1D24] w-full max-w-sm rounded-[2rem] p-6 slide-up-modal border border-white/10 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold">Catat Baru</h3>
                <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-slate-400 hover:text-white">
                    <i class="ph-bold ph-x"></i>
                </button>
            </div>

            <div class="space-y-5">
                <div class="flex p-1 bg-slate-800/50 rounded-xl relative">
                    <div id="typeIndicator" class="absolute top-1 left-1 w-[calc(50%-4px)] h-[calc(100%-8px)] bg-red-500 rounded-lg transition-all duration-300 shadow-lg"></div>
                    <button onclick="setTrxType('out')" class="flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-white" id="btnOut">Pengeluaran</button>
                    <button onclick="setTrxType('in')" class="flex-1 relative z-10 py-3 text-sm font-bold text-center transition-colors text-slate-400" id="btnIn">Pemasukan</button>
                </div>

                <div>
                    <label class="text-xs text-slate-400 ml-1 mb-1 block">Judul Transaksi</label>
                    <div class="relative">
                        <i class="ph-fill ph-tag absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-lg"></i>
                        <input id="trxTitle" type="text" placeholder="Contoh: Nasi Goreng" class="w-full bg-slate-900 border border-slate-700 rounded-xl py-4 pl-12 pr-4 text-white focus:border-blue-500 focus:outline-none transition-colors placeholder:text-slate-600">
                    </div>
                </div>

                <div>
                    <label class="text-xs text-slate-400 ml-1 mb-1 block">Nominal (Rp)</label>
                    <div class="relative">
                        <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 font-bold text-lg">Rp</span>
                        <input id="trxAmount" type="number" placeholder="0" class="w-full bg-slate-900 border border-slate-700 rounded-xl py-4 pl-12 pr-4 text-white font-mono text-lg focus:border-blue-500 focus:outline-none transition-colors placeholder:text-slate-600">
                    </div>
                </div>

                <button onclick="saveTransaction()" id="btnSave" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 h-14 rounded-xl font-bold text-lg shadow-lg shadow-blue-500/25 active:scale-95 transition-all mt-2">
                    Simpan
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, arrayUnion, arrayRemove, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // CONFIG FIREBASE MILIK RIFQY
        const firebaseConfig = {
            apiKey: "AIzaSyARO4mtlkpy1iw74mRODxg8tsoPYju91YU",
            authDomain: "rifqy-fi.firebaseapp.com",
            projectId: "rifqy-fi",
            storageBucket: "rifqy-fi.firebasestorage.app",
            messagingSenderId: "931864968075",
            appId: "1:931864968075:web:8ad6e4d4e185b6c6a78d8e"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let currentType = 'out'; // Default pengeluaran
        let isHidden = false;

        // --- AUTH SYSTEM ---
        window.loginGoogle = async () => {
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                Swal.fire({ icon: 'error', title: 'Oops...', text: error.message, background: '#1A1D24', color: '#fff' });
            }
        };

        window.logout = () => {
            Swal.fire({
                title: 'Keluar?',
                text: "Yakin mau istirahat dulu?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ya, Logout',
                background: '#1A1D24',
                color: '#fff'
            }).then((result) => {
                if (result.isConfirmed) signOut(auth);
            });
        };

        onAuthStateChanged(auth, (user) => {
            const loader = document.getElementById('loader');
            const login = document.getElementById('loginScreen');
            const app = document.getElementById('app');
            const nav = document.getElementById('bottomNav');

            if (user) {
                currentUser = user;
                login.classList.add('hidden');
                app.classList.remove('hidden');
                nav.classList.remove('hidden');
                
                // Update Profile
                document.getElementById('userImg').src = user.photoURL;
                document.getElementById('userName').innerText = user.displayName.split(' ')[0] + "!";
                setGreeting();
                
                syncData(user.uid);
                setTimeout(() => loader.classList.add('opacity-0', 'pointer-events-none'), 800);
            } else {
                login.classList.remove('hidden');
                app.classList.add('hidden');
                nav.classList.add('hidden');
                loader.classList.add('opacity-0', 'pointer-events-none');
            }
        });

        function setGreeting() {
            const hour = new Date().getHours();
            let text = "SELAMAT MALAM";
            if (hour >= 4 && hour < 11) text = "SELAMAT PAGI";
            else if (hour >= 11 && hour < 15) text = "SELAMAT SIANG";
            else if (hour >= 15 && hour < 18) text = "SELAMAT SORE";
            document.getElementById('greeting').innerText = text;
        }

        // --- DATABASE CORE ---
        async function syncData(uid) {
            const userRef = doc(db, "users", uid);
            
            onSnapshot(userRef, async (snap) => {
                if (snap.exists()) {
                    renderDashboard(snap.data());
                } else {
                    // Create New User Data
                    await setDoc(userRef, { balance: 0, income: 0, expense: 0, transactions: [] });
                }
            });
        }

        // --- RENDER UI ---
        function renderDashboard(data) {
            const fmt = (n) => isHidden ? "Rp ••••••" : new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(n);
            
            // 1. Update Kartu
            document.getElementById('mainBalance').innerText = fmt(data.balance || 0);
            document.getElementById('totalIn').innerText = "+" + fmt(data.income || 0);
            document.getElementById('totalOut').innerText = "-" + fmt(data.expense || 0);

            // 2. Health Bar Logic
            const income = data.income || 1; // avoid division by zero
            const expense = data.expense || 0;
            const percentage = Math.min((expense / income) * 100, 100);
            
            const bar = document.getElementById('healthBar');
            const healthText = document.getElementById('healthText');
            
            bar.style.width = `${percentage}%`;
            if(percentage > 80) {
                bar.className = "h-full bg-red-500 rounded-full transition-all duration-1000 shadow-[0_0_10px_rgba(239,68,68,0.5)]";
                healthText.innerText = "Warning: Boros!";
                healthText.className = "text-red-400 font-bold animate-pulse";
            } else {
                bar.className = "h-full bg-green-400 rounded-full transition-all duration-1000";
                healthText.innerText = "Kondisi Aman";
                healthText.className = "text-green-400";
            }

            // 3. Render List
            const list = document.getElementById('listTrx');
            const trxs = data.transactions || [];
            
            if (trxs.length === 0) {
                list.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10 opacity-50">
                        <i class="ph ph-notepad text-4xl mb-2"></i>
                        <p class="text-sm">Belum ada transaksi</p>
                    </div>`;
            } else {
                list.innerHTML = "";
                // Sort by ID (Timestamp) descending
                const sortedTrxs = [...trxs].sort((a, b) => b.id - a.id);
                
                sortedTrxs.forEach(t => {
                    const isIn = t.type === 'in';
                    const icon = isIn ? 'ph-arrow-down-left' : (t.categoryIcon || 'ph-shopping-cart');
                    
                    // Create Element with Event Listener for Delete
                    const el = document.createElement('div');
                    el.className = "glass-panel p-4 rounded-2xl flex justify-between items-center group active:scale-[0.98] transition-all cursor-pointer";
                    el.innerHTML = `
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full ${isIn ? 'bg-green-500/10 text-green-400' : 'bg-red-500/10 text-red-400'} flex items-center justify-center border border-white/5">
                                <i class="ph-fill ${icon} text-xl"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-sm text-white">${t.title}</h4>
                                <p class="text-[10px] text-slate-400 mt-0.5">${t.date}</p>
                            </div>
                        </div>
                        <p class="font-bold text-sm ${isIn ? 'text-green-400' : 'text-red-400'}">
                            ${isIn ? '+' : '-'}${fmt(t.amount)}
                        </p>
                    `;
                    
                    // Add Long Press / Click to Delete
                    el.onclick = () => confirmDelete(t);
                    list.appendChild(el);
                });
            }
        }

        // --- TRANSACTION LOGIC ---
        window.setTrxType = (type) => {
            currentType = type;
            const indicator = document.getElementById('typeIndicator');
            const btnIn = document.getElementById('btnIn');
            const btnOut = document.getElementById('btnOut');

            if (type === 'in') {
                indicator.style.transform = 'translateX(100%)'; // Geser ke kanan
                indicator.classList.replace('bg-red-500', 'bg-green-500');
                btnIn.classList.replace('text-slate-400', 'text-white');
                btnOut.classList.replace('text-white', 'text-slate-400');
            } else {
                indicator.style.transform = 'translateX(0)'; // Geser ke kiri
                indicator.classList.replace('bg-green-500', 'bg-red-500');
                btnOut.classList.replace('text-slate-400', 'text-white');
                btnIn.classList.replace('text-white', 'text-slate-400');
            }
        };

        window.saveTransaction = async () => {
            const title = document.getElementById('trxTitle').value;
            const amount = parseInt(document.getElementById('trxAmount').value);
            
            if (!title || !amount || amount <= 0) {
                return Swal.fire({ icon: 'warning', title: 'Data Kurang', text: 'Isi judul dan nominal dulu ya!', background: '#1A1D24', color: '#fff' });
            }

            // Close modal first for better UX
            closeModal();
            
            // Show loading toast
            const Toast = Swal.mixin({ toast: true, position: 'top-end', showConfirmButton: false, timer: 2000, background: '#1A1D24', color: '#fff' });
            Toast.fire({ icon: 'info', title: 'Menyimpan...' });

            const userRef = doc(db, "users", currentUser.uid);
            const snap = await getDoc(userRef);
            const data = snap.data();

            const newTrx = {
                id: Date.now(),
                title,
                amount,
                type: currentType,
                date: new Date().toLocaleString('id-ID', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' }),
                categoryIcon: currentType === 'out' ? 'ph-shopping-bag' : 'ph-money' // Default icon
            };

            const newBalance = currentType === 'in' ? data.balance + amount : data.balance - amount;
            const newIncome = currentType === 'in' ? data.income + amount : data.income;
            const newExpense = currentType === 'out' ? data.expense + amount : data.expense;

            await updateDoc(userRef, {
                balance: newBalance,
                income: newIncome,
                expense: newExpense,
                transactions: arrayUnion(newTrx)
            });

            Toast.fire({ icon: 'success', title: 'Tersimpan!' });
        };

        window.confirmDelete = (trx) => {
            Swal.fire({
                title: 'Hapus Transaksi?',
                html: `Yakin hapus <b>${trx.title}</b>?<br>Saldo akan dikembalikan.`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Ya, Hapus',
                cancelButtonText: 'Batal',
                background: '#1A1D24',
                color: '#fff'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    const userRef = doc(db, "users", currentUser.uid);
                    const snap = await getDoc(userRef);
                    const data = snap.data();

                    // Reverse calculation
                    let revBalance = data.balance;
                    let revIncome = data.income;
                    let revExpense = data.expense;

                    if (trx.type === 'in') {
                        revBalance -= trx.amount;
                        revIncome -= trx.amount;
                    } else {
                        revBalance += trx.amount;
                        revExpense -= trx.amount;
                    }

                    await updateDoc(userRef, {
                        balance: revBalance,
                        income: revIncome,
                        expense: revExpense,
                        transactions: arrayRemove(trx)
                    });
                    
                    Swal.fire({ title: 'Terhapus!', icon: 'success', timer: 1500, showConfirmButton: false, background: '#1A1D24', color: '#fff' });
                }
            });
        };

        // --- QUICK ACTIONS ---
        window.quickAdd = (category, type, icon) => {
            openModal();
            setTrxType(type);
            document.getElementById('trxTitle').value = category;
            // Hacky way to inject icon logic later, for now simple text fill
        };

        // --- UI HELPERS ---
        window.openModal = () => {
            document.getElementById('modalTrx').classList.remove('hidden');
            document.getElementById('modalContent').classList.remove('slide-down-modal');
            document.getElementById('modalContent').classList.add('slide-up-modal');
        };
        
        window.closeModal = () => {
            const modal = document.getElementById('modalTrx');
            modal.classList.add('hidden');
            // Reset form
            document.getElementById('trxTitle').value = "";
            document.getElementById('trxAmount').value = "";
        };

        window.toggleView = () => {
            isHidden = !isHidden;
            const icon = document.getElementById('eyeIcon');
            icon.className = isHidden ? "ph-bold ph-eye-slash text-xl" : "ph-bold ph-eye text-xl";
            // Trigger refresh manual karena variable isHidden local
            getDoc(doc(db, "users", currentUser.uid)).then(s => renderDashboard(s.data()));
        };
    </script>
</body>
</html>
